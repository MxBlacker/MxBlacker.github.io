---
date: 2025-09-16
tag: "#嵌入式"
layout: post
title: STM32 - 基础
---
#嵌入式
# ***STM32F103C8T6***

- ST是公司的名字，而M代表MCU (MicroControlUnit)，32是32位
- F代表通用型
- 101 = 基本型 102 = USB基本型 103 = 增强型 105/107 = 互联型
- T = 36脚 C = 48脚 R = 64脚 V = 100脚 Z = 144脚
- 8代表64K字节的闪存存储器

- 16~32K LD( Low Density ) 小容量产品
- 64~128K MD( Medium Density ) 中容量产品
- 256~511K HD 大容量产品
- >512K XD 加大容量产品
- CL 互联型产品
- 100型号产品会在后面加一个_VL

这些在选头文件的时候根据自己型号选

- T代表LQFP封装
- 6是工业级温度范围 -40 ~ 85

Keil5创建工程文件需要相应芯片的支持包，这个去网上找找就有了
### 基本信息

- 内核：ARM Cortex-M3
- 主频：72MHz
- RAM：20K SRAM
- ROM：64K Flash
- 供电：2.0-3.6V 标准3.3V
- 封装：LQFP48（48代表48引脚

### 片上资源 / 外设 Peripheral
我们先明确以下，**外设**指的就是以下这些东西，说是外设，但是**他们都集成于片内**!
外设都接在被称为**总线**的东西上，例如（AHB，APB1，APB2）
不同外设接在不同**总线**上，而像GPIO，ADC这种大部分都接在**APB2**上，**APB2是高速外设总线**!

而在使用外设前，我们需要**启动这条总线的时钟**
**所有的数字电路**（包括GPIO控制器）都需要一个**时钟信号来同步工作**。没有时钟，电路就无法执行任何操作，就像没有了心跳。

更详细的介绍见[[STM32 - 4 TIM中断概述#RCC时钟树]]

- **NVIC (Nested Vectored Interrupt Controller)**: 嵌套向量中断控制器
> [!tip]
> 这是用来控制**中断事件**的外设，所有**中断信号**都要经过这里，排队由CPU执行
- **SysTick**: 系统滴答定时器，计时用的
- **RCC (Rest and Clock Control)**: 复位和时钟控制
- **GPIO (General Purpose IO)**: 通用IO口，输入和输出数据
> [!tip]
> 我们一般的输入和输出都是在这里进行的
- **AFIO (Alternate Function IO)**: 复用IO口
> [!tip]
> 可以用来激活GPIO口的复用功能，或者在多个GPIO口里选一个用于中断判断
- **EXTI (External Interrupt/Event Controller)**: 外部中断
> [!tip]
> 中断见[[STM32 - 3 外部中断概述及EXTI中断概述]]，这个就是用于判断是否符合条件的
- **TIM (Timer)**: 分为高级定时器，通用定时器，基本定时器
> [!tip]
> TIM中断见[[STM32 - 4 TIM中断概述]]
- **ADC (Analog-to-Digital Converter)**: 模数转换器，可直接读IO口的电压值
- **DAC (Digital-to-Analog Converter)**: 数模转换器，
- **DMA (Direct Memory Access)**: 直接内存访问，帮CPU搬大量数据
- **USART (Universal Sync/Async Receiver/Transmitter)**: 同步\异步串口通信
- **I2C\SPI\CAN\USB**: 几种通信方式
- **RTC (RTC，Real Time Clock/Calendar)**: 实时时钟，可以接备用电池
- **CRC**: CRC校验
- **PWR (Power Control)**: 电源控制，省电用的
- **BKP (Backup Register)**: 备份寄存器，掉电时保持数据
- **IWDG (Independent WatchDog)**:  独立看门狗，看芯片有没有异常
- **WWDG (Windowed WatchDog)**: 窗口看门狗
- **SDIO (Secure Digital IO)**: SD卡接口
- **FSMC (Flexible Static Memory Controller)**: 可变静态存储控制器
- **USB OTG (USB On-the-go)**: USB主机接口，可以读其他USB

### 引脚定义

![[STM引脚.png]]

- **S**代表电源 **I/O**不解释
- **IO口电平**： 有FT ( Five Tolerate ) 的可以容忍5V电压，否则只能容忍3.3V

##### 提几个重要的

- **VBAT** 备用电源供电引脚，接3V电池
- **3,4**接RTC的
- **7**接复位电路，见下文，低电平复位
- **8,9 / 23.24,35,36,47,48(主电源口)** VSS是负极，VDD是3.3Vb  
- **STM采用分区供电，所以主电源口比较多**
- **10~19,25~33,41~43,45~46** 都是IO口，**20,44**是IO或者Boot引脚（那些安卓刷机视频里的）
- **34,37~40** 都是IO+调试端口，用于下载程序，我们使用SWD方式（STLINK），只占用34,37两个口

> [!attention]
> 注意，这些都只是STM32的引脚，至于封装之后给了多少就不一定了
> 像我们用的**LQFP**就是32引脚的，具体有什么片上都标了

## 下面是一些硬件上的知识
### 启动配置
上文提到了20，44做Boot，即启动配置引脚

![[STM启动配置.png]]

**X0** -> 正常执行Flash闪存中的程序（常用）
**01** -> 串口下载，例如，当上文提到的**五个调试端口**都被手动配置为IO口时，不存在下载端口，这时就用这种启动模式串流下载
**11** -> 程序调试

## 最小系统电路 #1

![[STM最小系统电路.png]]

- **接电源**时一般并一个电容稳压
- 先说明以下，晶振和**打点计时器**差不多，也和高频红石差不多，就是定时产生红石信号的，STM一般是用8MHz，**RTC**功能需要另接一个32.768(2^15)KHz的晶振，然后**接在3，4引脚**
- **复位电路**很好理解，但是可能需要复习一下通用技术的内容了，不按按钮NRST(7号引脚)出**高电平**，按了就是**低电平**
- **启动配置**中**H1**相当于switch，可以决定boot引脚接3.3V还是GND
- **下载端口**不多解释

**当然，板子都帮我们印好了，以下是实物图**

![[STM32实物图.png]]

**USB接口**同时也用来供电

[[Keil5工程建立]]