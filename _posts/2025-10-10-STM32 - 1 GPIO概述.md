---
date: 2025-09-16
tag: "#嵌入式"
layout: post
title: STM32 - GPIO概述
---
#嵌入式
# GPIO
**GPIO General Purpose Input Output** 通用输入输出口
这就是我们日常用来输入输出的口了

- 8种模式
- 0 ~ 3.3V , 部分容忍 5V ( 见[[STM引脚.png]]中FT )
- 输出模式下可控制端口电平，模拟通信协议输出时序 (I2C / SPI)...
- 输入模式下可读取端口电平，用于读取按键输入等，模拟接收协议

所有**GPIO**都接在**APB2**上，而**GPIO**也有多个，分为**GPIOA , GPIOB ...**
每一个**GPIO**都有**16个引脚**，如PA0 , PA1 ... PB0 , PB1 ...

**GPIO**内有**寄存器**和**驱动器**，而寄存器在[[Keil5工程建立]]里提到过，是用于存储数据和指令的
**APB2**可以直接调整每一个**GPIO中的寄存器**，从而**驱动驱动器**及其引脚
这样，显然，**32bit的寄存器中的==低16位**==每一位对应一个引脚的高低电平，1高0低v

# GPIO框图分析

![[STM32 GPIO位结构图.png]]

- 开头的两个**保护二极管**不多说，主要是为了防IO电压太大
- **输入驱动器**有**上拉电阻**和**下拉电阻**，这里的**上拉**和**下拉**意为==将电位上拉/下拉==，开启状态对应了不同模式，确认了默认时的状态
	- **上拉输入** : 仅开启上拉开关，默认为高电平，且为**弱上拉** ( 即上拉电阻大 )
	- **下拉输入** : 仅开启下拉开关，默认为低电平，且为**弱下拉**
	- **浮空输入** : 都不开启，此时引脚悬空，电平不确定，易受干扰
- **施密特触发器** : 见[[电控图分析]]
- 施密特触发器前的**模拟输入**一般连接到ADC，其后的复用功能连接到片上设备
	- **模拟输入** : 直接输入模拟信号，GPIO无效

- 输出有三种方式
	- 按位设置 / 清楚寄存器 ( 不会覆盖其他位 ) <- ==这种用的比较多==
	- 直接读写寄存器 ( 会覆盖其他位 )
	- 位带，即每一位实际分配了一个地址，可以直接修改
- **MOS管相当于电子开关**
	- **推挽输出** : 这是PNMOS均有效，输出高电平时，PMOS通，NMOS断，出高电平。低电平同理。这是高低电平驱动能力强，也可以叫“**强推输出模式**“
	- **开漏输出** : PMOS无效，经NMOS有驱动力。输出高电平时，NMOS断开，电路断开。低电平时就是低电平。这种可以作为通信协议的输出方式，避免设备互相干扰
	- **复用开漏，复用推挽** : 引脚电平由片上设备控制，即不由STM32控制
	
> [!attention] 如果想要输出5V电压
> 则需要在IO口外接一个上拉电阻到5V，低电平时直接接地为低电平，高电平时上拉为5V

- 一个端口只能有一个输出，但可以有多个输入

# GPIO寄存器
### 端口配置低 / 高寄存器 ( GPIOx_CRL / GPIOx_CRH ) ( x=A...E )
每一个端口的模式由四位二进制控制，一个GPIO有16个端口就是64位，而我们是STM32，是32位的，所以**要分高32位和低32位**
具体如何配置去参考**参考手册**
输出速度一般调整为50MHz

### 端口输入数据寄存器 ( GPIOx_IDR ) ( x=A...E )
仅低16位有效，一位对应一个端口

### 端口输出数据寄存器 ( GPIOx_ODR ) ( x=A...E )
仅低16位有效，一位对应一个端口

### 端口位设置 / 清除寄存器 ( GPIOx_BSRR ) ( x=A...E )
高16位用于位**清除**，低16位用于位**设置**
这里的设置意思就是**设为高电平**，清除就是**设为低电平**
**写1就是对对应位操作，写0就是不产生影响**

### 端口位清除寄存器 ( GPIOx_BRR )
这个和上面高16位的功能一样的，其主要目的就是为了方便读懂代码

### 端口配置锁定寄存器 ( GPIOx_LCKR )
就是锁定某个端口的值，使得其不能被改变

# GPIO库函数



# GPIO疑难杂症
简单来说，你要使用哪一套GPIO，就初始化哪一套
但是你会发现GPIOC只有三个引脚！这是为什么呢？难道其他引脚就用不了了？
实际上，这是**封装的问题**，在[[STM32 - 0 基础]]中我们提到了，我们使用的芯片的封装是**LQFP**，这种封装就**只有PC13~15的口和PA，PB的口**，其他就没引出来。

当然，为了解决引脚过少导致的功能过少的事实，STM32才会引入复用引脚来增加功能。


[[STM32 - 1.1 GPIO的初始化和使用]]
[[STM32 - 1.2 按钮及传感器的输入]]
[[STM32 - 2 OLED显示屏概述]]