---
date: 2025-09-16
tag: "#嵌入式"
layout: post
title: STM32 - 按钮及传感器的输入
---
#嵌入式 
[[C - 9 头文件的诞生]]
为了方便管理，我们以后很多情况下会用头文件来写
这里按钮按下后，端口变0，所以端口模式为上拉GPIO_Mode_IPU
## 有关库函数

```C
	uint8_t value;
	value = GPIO_ReadInputDataBit(GPIOx , GPIO_Pin_x);
```

这个返回某一位的值 （输入寄存器）

```C
	uint16_t value;
	value = GPIO_ReadInputData(GPIOx)；
```

这个返回所有位的值 （输入寄存器）
==**把Input改成Output就能读取输出寄存器的值了!**==

## 按钮感应程序

```C
	if(GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_1) == 0){ //输入为0,说明按钮被按下
		Delay_ms(20);
		while(GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_1) == 0);
		Delay_ms(20);
		Keynum = 1;
	}
	if(GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_11) == 0){
		Delay_ms(20);
		while(GPIO_ReadInputDataBit(GPIOA,GPIO_Pin_11) == 0);
		Delay_ms(20);
		Keynum = 2;
	}
	return Keynum;
```

这里不用担心覆盖，因为程序运行时间极快

在学过EXTI后，为节能，我们可能想到**用EXTI来检测按钮**的按下
但是这其实是不妥的，因为按钮的抖动会多次触发函数，导致效果极其差劲
况且，Delay函数的存在会导致整个CPU的停滞，这被称为**电路阻塞**
要解决这两个问题，见[[STM32 - 4.1 EX 非阻塞式电路]]

## 传感器感应程序
[[电器元件#有源 / 无源蜂鸣器]] [[电器元件#传感器]]
这里蜂鸣器接PB12，DO接PB13

```C
	uint8_t Lightsensor = GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_13);
```

后面自己写，也就Setbits一下