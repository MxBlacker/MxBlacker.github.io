---
date: 2025-09-16
tag: "#嵌入式"
layout: post
title: STM32 - GPIO的初始化和使用
---
#嵌入式 
# GPIO初始化
Somehow代码的第一个执行代码都是要**开启时钟**

> [!tip] 问题已解决
> [[STM32 - 4 TIM中断概述#RCC时钟树及其框图]]

这里我们LED接入的是GPIOA的PA0端口

```C
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA , ENABLE);
```

然后就是初始化GPIOA

```C
	GPIO_InitTypeDef GPIO_InitStructure；
	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 
```

OutPP就是推挽输出了

```C
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0；
	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz；
	GPIO_Init(GPIOA , &GPIO_InitStructure)；
```

这样就初始化好了
**这里拓展一下输出模式**

- GPIO_Mode_AIN = 0x0 模拟输入
- GPIO_Mode_IN_FLOATING 浮空输入
- GPIO_Mode_IPD = 0x28 下拉输入
- GPIO_Mode_IPU = 0x48 上拉输入
- GPIO_Mode_Out_OD = 0x14 开漏输出
- GPIO_Mode_Out_PP = 0x10 推挽输出
- GPIO_Mode_AF_OD = 0x1C 复用开漏输出
- GPIO_Mode_AF_PP = 0x18 复用开漏输出

# GPIO相关库函数
### GPIO写入函数

```C
	GPIO_SetBits(GPIO_TypeDef* GPIOx , uint16_t GPIO_Pin)
	GPIO_ResetBits(GPIO_TypeDef* GPIOx , uint16_t GPIO_Pin)
```

这里前面一个参数写GPIOx，后一个写端口号，Set就是高电平，Reset就是低电平

```C
	GPIO_WriteBit(GPIO_TypeDef* GPIOx , unit16_t GPIO_Pin , Bit_RESET / Bit_SET)
```

这里的Bit_RESET和Bit_SET是宏定义，定义的是BitAction类型变量
所以也可以填(BitAction)0和(BitAction)1
功能和上面的一样，就是加了个参数 , Bit_RESET就是低电平，Bit_SET就是高电平

#### 更多关于GPIO的函数
```C
	GPIO_PinLockConfig(GPIOx , Pin)
```
这个函数的功能是锁定某个引脚的配置

```C
	GPIO_PinRemapConfig(GPIO_Remap,Newstate);
```
这个用于引脚重映射，第一个参数是重映射的方式，第二个是新的状态

# 延迟函数
当然，这里面可没有Sleep，Sleep是window.h的东西，这里我们可不是对窗口进行操作！
我们需要引入Delay.h / Delay.c

```C
	#include "Delay.h"

	Delay_us(uint32_t us)；
	Delay_ms(uint32_t ms)；
	Delay_s(uint32_t s)；
```

顾名思义，微秒毫秒和秒，具体是通过计时器实现的，下面是函数的代码

```C
	SysTick->LOAD = 72 * xus //设置计时器重装值
	SysTick->VAL = 0x00 //清空计时器
	SysTick->CTRL = 0x00000005 //设置HCLK源，启动
	while(!(SysTick->CTRL & 0x00010000)); //等待计时结束
	SysTick->CTRL = 0x00000004; //关闭计时器
```

# LED流水灯
任意用一下两个指令就可以同时初始化多个端口

```C
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0 | GPIO_Pin_1 | GPIO_Pin_2 | ...；
	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_All；
```

接下来就是While循环内的写入部分了，这里我们用Write

```C
	GPIO_Write(GPIOA, 0x0001); // 0000 0000 0000 0001 AP1高电平
```

当然，因为只取低16位，所以这里的十六进制只有四位就够了

```C
	GPIO_Write(GPIOA, 0x0002); // 0000 0000 0000 0010 AP2高电平
	GPIO_Write(GPIOA, 0x0004); // 0000 0000 0000 0100 AP3高电平
	...
```

# 蜂鸣器
蜂鸣器发出的声音和振荡的频率有关，所以你只需要改Delay_ms里的值就行了

