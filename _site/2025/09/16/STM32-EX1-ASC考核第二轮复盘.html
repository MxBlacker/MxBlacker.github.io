<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>STM32 - ASC考核第二轮复盘 | 麦香包の超平坦世界</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="STM32 - ASC考核第二轮复盘" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="#嵌入式 TIME TABLE 11.1 学习Git并学习完毕 11.2 使用Git并开始学习SolidWorks，且学习完毕，开始看的6.3 ~ 6.8 / 9.1 ~ 9.5 11.3 6.3~6.8学习完毕，开始着手编写代码 11.4 9.1 ~ 9.5学习完毕，开始着手编写代码 11.5 调试代码，调试不成功 11.6 调试成功" />
<meta property="og:description" content="#嵌入式 TIME TABLE 11.1 学习Git并学习完毕 11.2 使用Git并开始学习SolidWorks，且学习完毕，开始看的6.3 ~ 6.8 / 9.1 ~ 9.5 11.3 6.3~6.8学习完毕，开始着手编写代码 11.4 9.1 ~ 9.5学习完毕，开始着手编写代码 11.5 调试代码，调试不成功 11.6 调试成功" />
<link rel="canonical" href="http://localhost:4000/2025/09/16/STM32-EX1-ASC%E8%80%83%E6%A0%B8%E7%AC%AC%E4%BA%8C%E8%BD%AE%E5%A4%8D%E7%9B%98.html" />
<meta property="og:url" content="http://localhost:4000/2025/09/16/STM32-EX1-ASC%E8%80%83%E6%A0%B8%E7%AC%AC%E4%BA%8C%E8%BD%AE%E5%A4%8D%E7%9B%98.html" />
<meta property="og:site_name" content="麦香包の超平坦世界" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-16T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="STM32 - ASC考核第二轮复盘" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-09-16T00:00:00+08:00","datePublished":"2025-09-16T00:00:00+08:00","description":"#嵌入式 TIME TABLE 11.1 学习Git并学习完毕 11.2 使用Git并开始学习SolidWorks，且学习完毕，开始看的6.3 ~ 6.8 / 9.1 ~ 9.5 11.3 6.3~6.8学习完毕，开始着手编写代码 11.4 9.1 ~ 9.5学习完毕，开始着手编写代码 11.5 调试代码，调试不成功 11.6 调试成功","headline":"STM32 - ASC考核第二轮复盘","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2025/09/16/STM32-EX1-ASC%E8%80%83%E6%A0%B8%E7%AC%AC%E4%BA%8C%E8%BD%AE%E5%A4%8D%E7%9B%98.html"},"url":"http://localhost:4000/2025/09/16/STM32-EX1-ASC%E8%80%83%E6%A0%B8%E7%AC%AC%E4%BA%8C%E8%BD%AE%E5%A4%8D%E7%9B%98.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="麦香包の超平坦世界" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">麦香包の超平坦世界</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">STM32 - ASC考核第二轮复盘</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-09-16T00:00:00+08:00" itemprop="datePublished">Sep 16, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>#嵌入式</p>
<h2 id="time-table">TIME TABLE</h2>
<ul>
  <li>11.1 学习Git并学习完毕</li>
  <li>11.2 使用Git并开始学习SolidWorks，且学习完毕，开始看的6.3 ~ 6.8 / 9.1 ~ 9.5</li>
  <li>11.3 6.3~6.8学习完毕，开始着手编写代码</li>
  <li>11.4 9.1 ~ 9.5学习完毕，开始着手编写代码</li>
  <li>11.5 调试代码，调试不成功</li>
  <li>11.6 调试成功</li>
</ul>

<h2 id="难点总结">难点总结</h2>
<h5 id="1-初始化不到位">1 初始化不到位</h5>
<p>一定要搞清楚的是，一旦你在GPIO口输出或者输入，就一定要初始化！一定要初始化！我不知道被这个浪费了多少时间，每次以为初始化好了，结果都有疏漏！所以我才会写这么多封装好的初始化函数。这样不仅方便，在测试后也能防止以后初始化再出错。</p>

<pre><code class="language-C">	//控制电机方向的口
	AutoInitGPIO(GPIOB,GPIO_Mode_Out_PP,GPIO_Pin_12,GPIO_Speed_50MHz);
	AutoInitGPIO(GPIOB,GPIO_Mode_Out_PP,GPIO_Pin_13,GPIO_Speed_50MHz);
	AutoInitGPIO(GPIOB,GPIO_Mode_Out_PP,GPIO_Pin_14,GPIO_Speed_50MHz);
	AutoInitGPIO(GPIOB,GPIO_Mode_Out_PP,GPIO_Pin_15,GPIO_Speed_50MHz);
</code></pre>

<h5 id="2-中断开启与中断配置">2 中断开启与中断配置</h5>
<p>另一个消耗了我很长时间的是中断的开启和配置，<strong>OC是可以和定时中断同时存在的！</strong> 然后，ITConfig一定要记得打开，不然你以为IT是什么？是Interrupt!
中断优先级的配置更是逆天，这里就提一嘴</p>

<h5 id="3-代码逻辑性问题">3 代码逻辑性问题</h5>
<p>说实话，我从一开始就没太搞清楚代码的逻辑，导致编的时候一直处于一种混乱的状态，建议以后先想清楚了要先干什么，达到什么样的目的，再编写下一部分代码</p>

<h5 id="4-pid不清楚">4 PID不清楚</h5>
<p>这个等下我专门开一个PID来讲把，我对其有一些独到的理解</p>

<pre><code class="language-C">float PID_Control(MotorTypeDef * Motor , PIDTypeDef * PID){
	
	PID-&gt;error = Motor-&gt;Target_Speed - Motor-&gt;Cur_Speed;
	
	// 比例，相当于往哪里动，动多少，是最主要的推动力
	float proportional_score = PID-&gt;KP * PID-&gt;error;
    
	// 积分，把最后一点偏差去除掉
	PID-&gt;I += PID-&gt;error;
	// 积分限幅
	if(PID-&gt;I &gt; PID-&gt;I_Lim) PID-&gt;I = PID-&gt;I_Lim;
	if(PID-&gt;I &lt; -PID-&gt;I_Lim) PID-&gt;I = -PID-&gt;I_Lim;
	float integral_score = PID-&gt;KI * PID-&gt;I;
	
	// 微分，看看现在多块，好刹车
	float derivative_score = PID-&gt;KD * (PID-&gt;error - PID-&gt;prev_error);
	
	// 总输出
	float output = proportional_score + integral_score + derivative_score;
		
	// 输出限幅
	if(output &gt; PID-&gt;Output_Lim) output = PID-&gt;Output_Lim;
	if(output &lt; -PID-&gt;Output_Lim) output = -PID-&gt;Output_Lim;
	
	PID-&gt;prev_error = PID-&gt;error;
	
    return output;
}
</code></pre>

<h5 id="5-单位量纲问题">5 单位量纲问题</h5>
<p>这个是我一直忽略，也是卡我时间卡的最久的。我一直没有意识到SetSpeed函数里填入的实际上是CCR的值，他是一个<strong>无向量纲</strong>，而我们计算出来的转速实际上是<strong>pulse / ms</strong>的单位，这两个根本对不上！所以为了解决这个问题，我们需要把速度转化为<strong>CCR</strong>，也就是除以满转的<strong>pulse / ms</strong>，得到一个比例，最后乘以<strong>Period</strong>就可以了</p>

<pre><code class="language-C">void Cal_Current_Speed(MotorTypeDef * Motor , TIM_TypeDef * TIMx){
		
	Motor-&gt;Prev_Count = Motor-&gt;Cur_Count;
	Motor-&gt;Cur_Count = TIM_GetCounter(TIMx);
    
	// 计算脉冲差值（处理溢出）
	int32_t pulse_diff = (int32_t)Motor-&gt;Cur_Count - (int32_t)Motor-&gt;Prev_Count;
	if(pulse_diff &gt; 32767) pulse_diff -= 65536;
	else if(pulse_diff &lt; -32768) pulse_diff += 65536;
        
	// 转换为实际转速（转/秒）
	// 10ms内的脉冲数 → 1秒内的脉冲数 → 转数
	Motor-&gt;Cur_Speed = (( (float)pulse_diff * 100 / PULSES_PER_REV ) / MAX_RPS) * 1000; // 这里得到的就应该是和CCR量纲一样的东西了
}
</code></pre>

<h5 id="6-vofa上位机问题的解决">6 VOFA上位机问题的解决</h5>
<p>这个还好，我注意到一直启用的是<strong>RawInput</strong>模式，很自然想到的是<strong>FireWater</strong>应该可以自动读取数据，本来我还说会不会需要自己写一个接收包的程序</p>

<h5 id="7-没有开启降压模块电源">7 没有开启降压模块电源</h5>
<p><strong>我说为什么我电机不转，原来是电源没开啊😓</strong>
由于纯理论派的学习，我把lsh的面包板拿过来之后，很长一段时间都在研究电机为什么没有转，结果是因为降压电源模块没有开！我都不知道要开！这耗费了我<strong>两个多小时无意义的纠错</strong>！</p>

<p>我是傻逼</p>


  </div><a class="u-url" href="/2025/09/16/STM32-EX1-ASC%E8%80%83%E6%A0%B8%E7%AC%AC%E4%BA%8C%E8%BD%AE%E5%A4%8D%E7%9B%98.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">麦香包の超平坦世界</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">麦香包の超平坦世界</li><li><a class="u-email" href="mailto:sweetwheatbread@gmail.com">sweetwheatbread@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/MxBlacker"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">MxBlacker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
